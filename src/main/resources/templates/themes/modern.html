<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
      th:with="
        nameColor=${resume.design.colors.name},
        titleColor=${resume.design.colors.sectionTitles},
        entryTitleColor=${resume.design.colors.titles ?: '#111111'},
        subTitleColor=${resume.design.colors.subtitles ?: resume.design.colors.sectionTitles},
        bodyColor=${resume.design.colors.body},
        fontFamily=${selectedFont}">
<head>
    <meta charset="UTF-8" />
    <title th:text="${resume.cv.name} + ' - Resume'"></title>
    <style>
        @page { size: letter; margin: 0.4in; }
        body { margin: 0; padding: 0; line-height: 1.4; font-size: 10pt; width: 100%; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        td { vertical-align: top; }
        .header-table { margin-bottom: 15pt; border-bottom: 1.5pt solid #eee; padding-bottom: 10pt; }
        .name { font-size: 28pt; font-weight: 800; margin: 0; text-transform: uppercase; }
        .tagline { font-size: 11pt; font-weight: 700; margin: 5pt 0; }
        .profile-img { width: 80pt; height: 80pt; border-radius: 50%; border: 2pt solid #e2e8f0; object-fit: cover; }
        .section-title {
            font-size: 11pt; font-weight: 800; text-transform: uppercase;
            border-bottom: 2pt solid #000; margin-top: 15pt; margin-bottom: 10pt;
        }
        td > div:first-child .section-title { margin-top: 0; }
        .experience-container { border-left: 1.5pt solid #e2e8f0; margin-left: 5pt; padding-left: 15pt; }
        .entry { margin-bottom: 12pt; }
        .entry-title { font-weight: 800; font-size: 10.5pt; }
        .skill-tag { display: inline-block; background: #f1f5f9; padding: 3pt 6pt; margin: 2pt; border-radius: 3pt; font-weight: 700; font-size: 8.5pt; }
    </style>
</head>
<body th:style="'font-family: \'' + ${fontFamily} + '\', sans-serif; color: ' + ${bodyColor}">

<table class="header-table">
    <tr>
        <td style="width: 75%;">
            <h1 class="name" th:style="'color: ' + ${nameColor}" th:utext="${resume.cv.name}">NAME</h1>
            <div class="tagline" th:if="${resume.cv.sections?.containsKey('tagline')}"
                 th:style="'color: ' + ${titleColor}" th:utext="${resume.cv.sections['tagline']}">TAGLINE</div>
            <div style="font-size: 9pt; color: #666;">
                <span th:utext="${resume.cv.email}">email</span>
                <span th:if="${resume.cv.location}"> | <span th:utext="${resume.cv.location}">location</span></span>
            </div>
        </td>
        <td style="width: 25%; text-align: right;">
            <img th:if="${resume.cv.photoUrl != null}" th:src="${resume.cv.photoUrl}" class="profile-img" />
        </td>
    </tr>
</table>

<table>
    <tr>
        <td style="width: 65%; padding-right: 20pt;">
            <div th:each="key : ${resume.design.layout.main}" th:if="${resume.cv.sections?.containsKey(key)}">
                <div th:with="data=${resume.cv.sections.get(key)}">
                    <div class="section-title" th:style="'border-color: ' + ${titleColor} + '; color: ' + ${titleColor}" th:utext="${#strings.toUpperCase(key)}">TITLE</div>
                    <div th:class="${key == 'experience' ? 'experience-container' : ''}">
                        <div th:if="${data instanceof T(java.util.List)}">
                            <div th:each="item : ${data}" class="entry">
                                <div th:if="${item instanceof T(java.util.Map)}">
                                    <div class="entry-title" th:style="'color: ' + ${entryTitleColor}"
                                         th:utext="${item['position'] ?: item['title'] ?: item['company'] ?: item['name']}">Title</div>
                                    <div th:style="'font-weight: 700; color: ' + ${subTitleColor}"
                                         th:if="${item['company'] ?: item['institution'] ?: item['subtitle']}"
                                         th:utext="${item['company'] ?: item['institution'] ?: item['subtitle']}">Sub</div>
                                    <ul th:if="${item['highlights']}"><li th:each="h : ${item['highlights']}" th:utext="${h}"></li></ul>
                                </div>
                                <div th:if="${item instanceof T(java.lang.String)}" th:utext="'â€¢ ' + ${item}"></div>
                            </div>
                        </div>
                        <div th:if="${data instanceof T(java.lang.String)}" th:utext="${data}"></div>
                    </div>
                </div>
            </div>
        </td>

        <td style="width: 35%; border-left: 1pt solid #eeeeee; padding-left: 15pt;" th:style="'background-color: ' + ${resume.design.colors.sidebarBackground}">
            <div th:each="key : ${resume.design.layout.sidebar}" th:if="${resume.cv.sections?.containsKey(key)}">
                <div th:with="data=${resume.cv.sections.get(key)}">
                    <div class="section-title" th:style="'border-color: ' + ${titleColor} + '; color: ' + ${titleColor}" th:utext="${#strings.toUpperCase(key)}">TITLE</div>
                    <div th:if="${data instanceof T(java.util.List)}">
                        <div th:each="item : ${data}" style="margin-bottom: 10pt;">
                            <div th:if="${item instanceof T(java.util.Map)}">
                                <div style="font-weight: 800;" th:style="'color: ' + ${entryTitleColor}"
                                     th:with="header=${item['role'] ?: item['title'] ?: item['institution'] ?: item['name'] ?: item.values().iterator().next()}"
                                     th:utext="${header}">Title</div>
                                <div th:style="'font-weight: 700; font-size: 8.5pt; color: ' + ${subTitleColor}"
                                     th:with="sub=${item['organization'] ?: item['details'] ?: item['area'] ?: item['issuer'] ?: item['date'] ?: ''}"
                                     th:if="${sub != ''}"
                                     th:utext="${sub}">Sub</div>
                            </div>
                            <div th:if="${item instanceof T(java.lang.String)}" class="skill-tag" th:utext="${item}">Tag</div>
                        </div>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>
</body>
</html>